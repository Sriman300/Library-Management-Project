<div class="max-w-4xl mx-auto p-6">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">Borrow Report (JOIN)</h1>
        <a href="/home" data-link class="text-sm text-blue-600 underline">
            ← Back to Home
        </a>
    </div>

    <!-- Explanation Block -->
    <div class="bg-blue-50 border border-blue-200 rounded p-4 mb-6 text-sm text-gray-700">
        <p class="font-semibold mb-1">What is this report?</p>
        <p>
            This view is <strong>not stored</strong> in the database.
            It is generated by <strong>combining data from multiple tables</strong>.
        </p>

        <ul class="list-disc list-inside mt-2">
            <li><strong>Books</strong> — which book borrowed</li>
            <li><strong>Students</strong> — who the borrower is</li>
            <li><strong>Librarians</strong> — which book borrowed</li>
            <li><strong>Borrows</strong> — how books, students and librarians are linked</li>
        </ul>

        <p class="mt-2">
            The system dynamically joins these tables using SQL
            <strong>JOIN</strong> operations to produce a meaningful report.
        </p>
    </div>

    <!-- Report Table -->
    <div class="bg-white p-5 rounded shadow">
        <h2 class="font-semibold mb-4 text-lg">
            Books ↔ Students ↔ Librarians (Joined View)
        </h2>

        <!-- Loading -->
        <div id="loadingSpinner" class="text-center py-4">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mx-auto"></div>
        </div>

        <!-- Table -->
        <div id="reportTableContainer" class="hidden overflow-x-auto">
            <table class="min-w-full text-left border">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-3 py-2">Borrow ID</th>
                        <th class="px-3 py-2">Book</th>
                        <th class="px-3 py-2">Student</th>
                        <th class="px-3 py-2">Librarian</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody"></tbody>
            </table>

            <p id="noRows" class="text-center text-gray-500 mt-3 hidden">
                No joined rows found.Borrow a book first.
            </p>

            <!-- Data Flow Hint -->
            <p class="text-xs text-gray-500 mt-4">
                Data flow:
                <strong>students</strong> → <strong>borrows</strong> → <strong>books</strong> &amp; <strong>librarians</strong>
            </p>

            <!-- Always-visible SQL block (documentation style) -->
            <div class="mt-6 border border-gray-200 rounded-lg overflow-hidden">
                <div class="bg-gray-50 px-4 py-3 flex items-center justify-between">
                    <p class="font-semibold text-sm text-gray-800">
                        SQL used to generate this report (JOIN)
                    </p>
                    <span class="text-xs text-gray-500">
                        Read-only
                    </span>
                </div>

                <pre class="bg-white px-4 py-4 text-sm overflow-x-auto leading-relaxed">
SELECT
    br.id AS borrow_id,
    b.title AS book_title,
    s.name AS student_name,
    l.name AS librarian_name,
FROM borrows br
JOIN books b ON br.book_id = b.id
JOIN students s ON br.student_id = s.id
JOIN librarian l ON br.librarian_id = l.id;
                </pre>

                <div class="bg-gray-50 px-4 py-3 text-xs text-gray-600">
                    Note: Book information is not duplicated in the student table.
                    This follows database normalization principles.
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts -->
    <div id="alertContainer" class="fixed top-4 right-4 space-y-2 z-50"></div>
</div>